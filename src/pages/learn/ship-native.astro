---
export const prerender = true;

import PageLayout from '../../layouts/PageLayout.astro';
import { getCollection } from 'astro:content';
import { SITE, PREMIUM_COURSE } from '../../lib/constants';
import CourseCard from '../../components/course/CourseCard.astro';
import BlogComments from '../../components/blog/BlogComments';

const allLessons = await getCollection('course', ({ data }) => !data.draft && data.courseSlug === 'ship-native');
const lessons = allLessons.sort(
  (a, b) => (a.data.module * 100 + a.data.lesson) - (b.data.module * 100 + b.data.lesson)
);

const moduleLessons = PREMIUM_COURSE.modules.map((mod) =>
  lessons.filter((l) => l.data.module === mod.number)
);

const publishedCount = lessons.length;
const publishedModules = [...new Set(lessons.map((l) => l.data.module))].length;

const courseSchema = {
  '@context': 'https://schema.org',
  '@type': 'Course',
  name: `${PREMIUM_COURSE.title} — ${PREMIUM_COURSE.subtitle}`,
  description: PREMIUM_COURSE.description,
  provider: {
    '@type': 'Organization',
    name: 'NativeFirst',
    sameAs: SITE.url,
  },
  isAccessibleForFree: false,
  offers: {
    '@type': 'Offer',
    price: '79',
    priceCurrency: 'USD',
    availability: 'https://schema.org/InStock',
  },
  hasCourseInstance: {
    '@type': 'CourseInstance',
    courseMode: 'online',
    courseWorkload: 'PT6H',
  },
  educationalLevel: 'Intermediate',
  teaches: 'Building a production iOS app with Swift 6, SwiftUI, SwiftData, and AI tools',
  inLanguage: 'en',
};

const techStack = [
  { name: 'Swift 6', desc: 'Strict concurrency' },
  { name: 'SwiftUI', desc: 'Declarative UI' },
  { name: 'SwiftData', desc: 'Persistence' },
  { name: 'Charts', desc: 'Visualizations' },
  { name: 'WidgetKit', desc: 'Home screen' },
  { name: 'App Intents', desc: 'Siri & Shortcuts' },
  { name: 'NaturalLanguage', desc: 'On-device ML' },
  { name: 'XCTest', desc: 'Testing' },
];

const outcomes = [
  'Build a complete iOS app (BetAway) from zero to App Store submission',
  'Write AI prompts that produce production-quality Swift code on the first try',
  'Implement MVVM + Service Layer architecture that scales',
  'Add on-device ML and sentiment analysis for intelligent features',
  'Create home screen widgets and Siri Shortcuts',
  'Set up CI/CD with GitHub Actions and TestFlight distribution',
];

const faqs = [
  {
    q: 'What do I need to get started?',
    a: 'A Mac with Xcode 16+, basic Swift/SwiftUI knowledge (you should know what a View and a @State property are), and an AI coding tool (Claude Code, Cursor, or GitHub Copilot).',
  },
  {
    q: 'Can I really build an app in 24 hours?',
    a: 'The course is designed for focused, sprint-style building. Following the Plan → Execute → Verify workflow for each lesson, most developers complete the full app in a single dedicated weekend.',
  },
  {
    q: 'Is BetAway really free for users?',
    a: 'Yes — BetAway is designed to be completely free, with no paywalls, no subscriptions, and no premium tiers. When someone is struggling with gambling addiction and $55,000 in debt, charging them for a recovery tool is wrong. You learn to build a real app — and that app helps real people.',
  },
  {
    q: 'Is there a refund policy?',
    a: 'Yes — 30-day money-back guarantee, no questions asked. If the course isn\'t for you, email us and we\'ll refund immediately.',
  },
  {
    q: 'Will the course be updated?',
    a: 'Absolutely. The course tracks the latest Swift and Xcode releases. You get lifetime access to all updates.',
  },
];
---

<PageLayout
  title={`${PREMIUM_COURSE.title} — ${PREMIUM_COURSE.subtitle} — ${SITE.name}`}
  description={PREMIUM_COURSE.description}
>
  <script type="application/ld+json" set:html={JSON.stringify(courseSchema)} />

  <!-- Breadcrumb -->
  <section class="bg-bg pt-6">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <nav class="flex items-center gap-2 text-sm text-text-muted">
        <a href="/learn" class="hover:text-accent transition-colors">Courses</a>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
        <span class="text-white font-medium">{PREMIUM_COURSE.title}</span>
      </nav>
    </div>
  </section>

  <!-- Hero -->
  <section class="relative py-20 sm:py-28 overflow-hidden bg-bg">
    <div class="absolute inset-0 bg-gradient-to-br from-accent-yellow/5 via-transparent to-accent/5"></div>
    <div class="relative max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-accent-yellow/10 text-accent-yellow text-sm font-medium mb-6">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
        </svg>
        Premium Course
      </div>

      <h1 class="font-display font-extrabold text-4xl sm:text-5xl md:text-6xl text-white mb-6 leading-tight">
        <span class="bg-gradient-to-r from-accent-yellow/50 to-accent/50 bg-clip-text text-transparent">{PREMIUM_COURSE.title}</span>
        <br />
        <span class="text-2xl sm:text-3xl md:text-4xl">{PREMIUM_COURSE.subtitle}</span>
      </h1>

      <p class="text-lg sm:text-xl text-text-muted mb-8 max-w-2xl mx-auto">
        {PREMIUM_COURSE.description}
      </p>

      <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
        <a
          href="#pricing"
          class="inline-flex items-center gap-2 px-8 py-4 rounded-full bg-gradient-to-r from-accent-yellow/50 to-accent/50 text-white font-semibold text-lg shadow-lg shadow-amber-500/25 hover:shadow-amber-500/40 transition-shadow"
        >
          Start Building — $79
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
          </svg>
        </a>
        <a
          href="#modules"
          class="inline-flex items-center gap-2 px-6 py-3 rounded-full border border-border text-text-muted font-medium hover:border-accent-yellow/40 transition-colors"
        >
          See the curriculum
        </a>
      </div>
    </div>
  </section>

  <!-- Stats -->
  <section class="py-8 border-t border-b border-border bg-surface">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-6 text-center">
        <div>
          <p class="font-display font-bold text-2xl text-white">{PREMIUM_COURSE.totalLessons}</p>
          <p class="text-sm text-text-muted">Lessons</p>
        </div>
        <div>
          <p class="font-display font-bold text-2xl text-white">{PREMIUM_COURSE.modules.length}</p>
          <p class="text-sm text-text-muted">Modules</p>
        </div>
        <div>
          <p class="font-display font-bold text-2xl bg-gradient-to-r from-accent-yellow/50 to-accent/50 bg-clip-text text-transparent">$79</p>
          <p class="text-sm text-text-muted">One-time payment</p>
        </div>
        <div>
          <p class="font-display font-bold text-2xl text-white">~6h</p>
          <p class="text-sm text-text-muted">Reading time</p>
        </div>
      </div>
    </div>
  </section>

  <!-- What you'll build -->
  <section class="py-16 sm:py-20 bg-bg">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="font-display font-bold text-2xl sm:text-3xl text-white mb-4">
          What You'll Build
        </h2>
        <p class="text-lg text-text-muted max-w-2xl mx-auto">
          <strong>BetAway</strong> — a completely free gambling recovery app with streak tracking, CBT-based therapy exercises, crisis intervention, and guided breathing. A real app that helps real people, built to ship.
        </p>
      </div>

      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {outcomes.map((outcome) => (
          <div class="flex items-start gap-3 p-4 rounded-xl border border-border bg-surface/50">
            <svg class="w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <p class="text-sm text-text-muted">{outcome}</p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Why BetAway -->
  <section class="py-16 sm:py-20 border-t border-border bg-gradient-to-br from-accent-green/5 via-transparent to-accent-green/5">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-10">
        <h2 class="font-display font-bold text-2xl sm:text-3xl text-white mb-4">
          Learn to Code. Build Something That Matters.
        </h2>
        <p class="text-lg text-text-muted max-w-2xl mx-auto">
          Most courses teach you to build a todo app. This one teaches you to build a tool that can change someone's life.
        </p>
      </div>

      <div class="grid sm:grid-cols-2 gap-6">
        <div class="p-6 rounded-2xl border border-accent-green/30 bg-bg/80">
          <div class="w-10 h-10 rounded-xl bg-accent-green/10 flex items-center justify-center mb-4">
            <svg class="w-5 h-5 text-accent-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
            </svg>
          </div>
          <h3 class="font-display font-semibold text-lg text-white mb-2">The Problem</h3>
          <p class="text-sm text-text-muted">
            80 million people worldwide struggle with gambling disorder. The suicide rate is 15x the general average. Fewer than 10% ever seek help — and the apps that exist today are not good enough.
          </p>
        </div>

        <div class="p-6 rounded-2xl border border-accent-green/30 bg-bg/80">
          <div class="w-10 h-10 rounded-xl bg-accent-green/10 flex items-center justify-center mb-4">
            <svg class="w-5 h-5 text-accent-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
            </svg>
          </div>
          <h3 class="font-display font-semibold text-lg text-white mb-2">What BetAway Does</h3>
          <p class="text-sm text-text-muted">
            BetAway is a completely free, offline-first recovery app. No paywalls, no cloud accounts, no data sharing. Streak tracking, CBT-based therapy, crisis intervention, guided breathing — all private, all on-device.
          </p>
        </div>
      </div>

      <div class="mt-8 p-6 rounded-2xl border border-accent-green/30 bg-bg/80 text-center">
        <p class="text-text-muted text-sm leading-relaxed max-w-2xl mx-auto">
          By taking this course, you don't just learn to build iOS apps — you build one that is designed to help people in crisis. The same SwiftUI, SwiftData, and architecture patterns you will learn here are the ones used in every serious production app. The difference is that this one ships with a purpose.
        </p>
        <a href="/blog/gambling-addiction-tech-responsibility" class="inline-flex items-center gap-1.5 text-sm font-medium text-accent-green mt-3 hover:gap-2.5 transition-all">
          Read our research on gambling addiction and tech
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Tech Stack -->
  <section class="py-12 border-t border-border bg-surface">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <h3 class="font-display font-semibold text-lg text-white text-center mb-8">
        Technologies You'll Master
      </h3>
      <div class="flex flex-wrap items-center justify-center gap-3">
        {techStack.map((tech) => (
          <div class="flex items-center gap-2 px-4 py-2 rounded-full border border-border bg-surface">
            <span class="text-sm font-semibold text-white">{tech.name}</span>
            <span class="text-xs text-text-muted">{tech.desc}</span>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Modules -->
  <section id="modules" class="py-16 sm:py-20 bg-bg">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="font-display font-bold text-2xl sm:text-3xl text-white mb-10 text-center">
        Course Curriculum
      </h2>

      <div class="space-y-8">
        {PREMIUM_COURSE.modules.map((mod, i) =>
          moduleLessons[i].length > 0 ? (
            <CourseCard
              moduleNumber={mod.number}
              moduleTitle={mod.title}
              moduleDescription={mod.description}
              lessons={moduleLessons[i]}
            />
          ) : (
            <div class="relative rounded-2xl border border-dashed border-border p-6 sm:p-8">
              <div class="flex items-center gap-3 mb-2">
                <span class="inline-flex items-center justify-center w-10 h-10 rounded-xl bg-surface-2 text-text-muted font-display font-bold text-lg">
                  {mod.number}
                </span>
                <div>
                  <p class="text-xs font-medium text-text-muted uppercase tracking-wider">Module {mod.number}</p>
                  <h3 class="font-display font-bold text-lg text-text-muted">{mod.title}</h3>
                </div>
              </div>
              <p class="text-text-muted text-sm ml-[52px]">{mod.description}</p>
              <p class="text-xs text-text-muted ml-[52px] mt-2">{mod.lessonCount} lessons</p>
            </div>
          )
        )}
      </div>
    </div>
  </section>

  <!-- Who is this for -->
  <section class="py-16 sm:py-20 border-t border-border bg-surface">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="font-display font-bold text-2xl sm:text-3xl text-white mb-10 text-center">
        Who Is This For?
      </h2>

      <div class="grid sm:grid-cols-2 gap-6">
        <div class="p-6 rounded-2xl border border-accent-green/30 bg-accent-green/5">
          <h3 class="font-display font-semibold text-lg text-accent-green mb-3">Perfect for you if:</h3>
          <ul class="space-y-2">
            {['You know basic Swift/SwiftUI and want to build a real app',
              'You want to learn how AI tools accelerate iOS development',
              'You prefer learning by building, not watching videos',
              'You want production patterns, not toy examples'].map((item) => (
              <li class="flex items-start gap-2 text-sm text-text-muted">
                <svg class="w-4 h-4 text-green-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                {item}
              </li>
            ))}
          </ul>
        </div>

        <div class="p-6 rounded-2xl border border-accent-pink/30 bg-accent-pink/5">
          <h3 class="font-display font-semibold text-lg text-red-700 mb-3">Not for you if:</h3>
          <ul class="space-y-2">
            {['You\'ve never written any Swift code before',
              'You\'re looking for a video course',
              'You want cross-platform (React Native/Flutter)',
              'You expect the AI to do everything — you still need to think'].map((item) => (
              <li class="flex items-start gap-2 text-sm text-text-muted">
                <svg class="w-4 h-4 text-red-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
                {item}
              </li>
            ))}
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <section class="py-16 sm:py-20 bg-bg">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="font-display font-bold text-2xl sm:text-3xl text-white mb-10 text-center">
        Frequently Asked Questions
      </h2>

      <div class="space-y-6">
        {faqs.map((faq) => (
          <div class="border-b border-border pb-6">
            <h3 class="font-display font-semibold text-lg text-white mb-2">
              {faq.q}
            </h3>
            <p class="text-text-muted text-sm leading-relaxed">
              {faq.a}
            </p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Pricing CTA -->
  <section id="pricing" class="py-16 sm:py-20 bg-surface border-t border-border">
    <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <div class="rounded-2xl border border-accent-yellow/30 bg-bg p-8 sm:p-12 shadow-xl shadow-amber-500/5">
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-accent-yellow/10 text-accent-yellow text-xs font-semibold mb-4">
          LIFETIME ACCESS
        </div>

        <h2 class="font-display font-extrabold text-3xl sm:text-4xl text-white mb-2">
          Ship Native
        </h2>
        <p class="text-text-muted mb-6">
          Everything you need to build and ship a real iOS app with AI.
        </p>

        <div class="mb-8">
          <span class="font-display font-extrabold text-5xl bg-gradient-to-r from-accent-yellow/50 to-accent/50 bg-clip-text text-transparent">$79</span>
          <span class="text-text-muted ml-1">one-time</span>
        </div>

        <ul class="text-left space-y-3 mb-8 max-w-sm mx-auto">
          {[
            `${PREMIUM_COURSE.totalLessons} hands-on lessons across ${PREMIUM_COURSE.modules.length} modules`,
            'Copy-paste AI prompts for every feature',
            'Complete BetAway app source code',
            'Lifetime access + free updates',
            '30-day money-back guarantee',
          ].map((item) => (
            <li class="flex items-start gap-2 text-sm text-text-muted">
              <svg class="w-4 h-4 text-amber-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              {item}
            </li>
          ))}
        </ul>

        <a
          href="#"
          data-gumroad-product="ship-native"
          class="inline-flex items-center gap-2 px-10 py-4 rounded-full bg-gradient-to-r from-accent-yellow/50 to-accent/50 text-white font-semibold text-lg shadow-lg shadow-amber-500/25 hover:shadow-amber-500/40 transition-all hover:scale-[1.02]"
        >
          Get Instant Access
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
          </svg>
        </a>

        <p class="mt-4 text-xs text-text-muted">
          Secure checkout via Gumroad. Instant delivery.
        </p>
      </div>
    </div>
  </section>

  <!-- Comments -->
  <section class="py-16 sm:py-20 bg-bg">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
      <div id="comments">
        <BlogComments slug="learn-ship-native" client:visible />
      </div>
    </div>
  </section>
</PageLayout>
